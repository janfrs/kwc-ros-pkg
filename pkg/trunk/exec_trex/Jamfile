SubDir exec_trex ;

if ! $(ROS_PACKAGE_PATH) {
     	echo "" ; echo "" ;
        echo "ERROR: You need to set ROS_PACKAGE_PATH." ;
	echo "" ; echo "" ;
} else if ! $(exec_trex_READY) {

	# All this ROS and PR related stuff needs to be cleaned up. As it stands, it will not have any make integration
	# for when ROS or Pr change. Also, the declarations at this level force linkage of more than should otherwise
	# be necessary

	# Define Libraries required for ROS:  Can obtain from rospack export/cpp/lflags roscp
   	NEEDLIBS = 	[ FDirName $(ROS_ROOT) core roscpp lib libros.a ]
			[ FDirName $(ROS_ROOT) 3rdparty xmlrpc++ libXmlRpc.a ]
			[ FDirName $(ROS_ROOT) util rosthread lib librosthread.a ]
			[ FDirName $(ROS_ROOT) util rostime lib librostime.a ]
			[ FDirName $(ROS_PACKAGE_PATH) 3rdparty player player lib libwavefront_standalone.so ]	       
			[ FDirName $(ROS_PACKAGE_PATH) util transforms rosTF lib
   			  librosTF.a ]
			[ FDirName $(ROS_PACKAGE_PATH) util transforms libTF lib libTF.a
   			]
			[ FDirName $(ROS_PACKAGE_PATH) 3rdparty newmat10 newmat newmat10
   			  libnewmat.a ] ;

	# Include directories for ROS. Can obtain from rospack export/cpp/cflags roscpp
   	SubDirHdrs $(ROS_ROOT) core roscpp include ;
   	SubDirHdrs $(ROS_ROOT) util rosthread include ;
   	SubDirHdrs $(ROS_ROOT) util rostime include ;
	SubDirHdrs $(ROS_ROOT) core rostools msg cpp ;
   	SubDirHdrs $(ROS_ROOT) 3rdparty xmlrpc++ src ;
   	SubDirHdrs $(ROS_ROOT) std_msgs msg cpp ;
	SubDirHdrs $(ROS_ROOT) std_srvs srv cpp ;		
	
	SubDirHdrs $(ROS_PACKAGE_PATH) 3rdparty player player include player-2.2 ;
	SubDirHdrs $(ROS_PACKAGE_PATH) util transforms rosTF include ;
	SubDirHdrs $(ROS_PACKAGE_PATH) util transforms libTF include ;
	SubDirHdrs $(ROS_PACKAGE_PATH) 3rdparty newmat10 newmat ;
	SubDirHdrs $(ROS_PACKAGE_PATH) util transforms namelookup srv cpp ;

	# GNU Library include directories
	SubDirHdrs / usr include gtk-2.0 ;
	SubDirHdrs / usr include glib-2.0 ;
	SubDirHdrs / usr lib glib-2.0 include ;

	# Need to add this to obtain clock get time. Also need gtk for pix buf image loading when using wavefront
	# planner
	LINKFLAGS = $(LINKFLAGS) -lrt  -lgtk-x11-2.0 ;

	ModuleMain exec_trex : Executive.cc RCSVelAdapter.cc RCSArmAdapter.cc ROSNode.cc 
	CalcCommandConstraint.cc CalcGlobalPathConstraint.cc WavefrontPlanner.cc map_helpers.cc ExecDefs.cc Components.cc pr2.model.o : TREX : exec_trex ;
	Depends exec_trex : exec_inputs ;

	ModuleMain exec_listener : ExecListener.cc : : exec_listener ;
	ModuleMain rcs : RCS.cc ExecDefs.cc : TREX : rcs ;
	ModuleMain logger : MessageLogger.cc ExecDefs.cc : TREX : logger ;

 	# Input file for exec
	local TestInputs = 
		pr2.exec.nddl
		pr2.wpc.nddl
		pr2.sim.nddl
		clean.0.exec.nddl
		clean.0.wpc.nddl
		clean.0.rcsarm.nddl
		wpc.0.wpc.nddl
	;

	local file ;
 	for file in [ FGristFiles $(TestInputs) ] {
  		local xml = $(file:S=.xml:G=) ;
		LocalDepends exec_inputs : $(xml) ;
  		NddlParser $(xml) : $(file) ;
 	}
 
 	# Build the model - generates .cc and .hh files from .nddl
	NddlModel pr2.model.nddl : System ;

	# Build all
	Depends exec_all : exec_trex rcs exec_listener logger exec_inputs ;
}
